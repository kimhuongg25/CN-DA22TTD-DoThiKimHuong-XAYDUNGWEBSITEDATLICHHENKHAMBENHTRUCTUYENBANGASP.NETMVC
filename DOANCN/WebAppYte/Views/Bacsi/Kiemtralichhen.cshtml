@model PagedList.IPagedList<WebAppYte.Models.LichKham>
@using PagedList.Mvc;

@{
    ViewBag.Title = "Quản lý Lịch hẹn";
    Layout = "~/Views/Shared/_Layout.cshtml";

    // Kiểm tra đăng nhập
    var userBS = Session["userBS"] as WebAppYte.Models.QuanTri;
    if (userBS == null)
    {
        Response.Redirect(Url.Action("Dangnhap", "Home"));
        return;
    }
}

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

<style>
    :root {
        --primary: #0d6efd;
        --success: #198754;
        --warning: #ffc107;
        --danger: #dc3545;
        --bg-light: #f8f9fa;
        --border-color: #dee2e6;
    }

    body {
        font-family: 'Inter', sans-serif;
        background-color: #f4f6f9;
    }

    .content-wrapper {
        min-height: 85vh;
        padding: 0px 0 0px 0;
    }

    /* Header & Filter Tabs */
    .page-header {
        margin-bottom: 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
    }

    .page-title {
        font-weight: 700;
        color: #343a40;
        margin: 0;
        font-size: 24px;
        display: flex;
        align-items: center;
    }

    .filter-tabs {
        display: inline-flex;
        background: white;
        padding: 5px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .filter-link {
        padding: 8px 15px;
        border-radius: 6px;
        text-decoration: none;
        color: #6c757d;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.2s;
    }

        .filter-link:hover {
            background-color: #f1f3f5;
            color: #343a40;
        }

        .filter-link.active {
            background-color: var(--primary);
            color: white;
        }

    /* Table Styles */
    .table-container {
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        overflow: hidden;
        border: 1px solid var(--border-color);
    }

    .table-custom {
        width: 100%;
        margin-bottom: 0;
        border-collapse: collapse;
    }

        .table-custom th {
            background-color: #f8f9fa;
            color: #495057;
            font-weight: 600;
            padding: 15px;
            text-transform: uppercase;
            font-size: 13px;
            border-bottom: 2px solid var(--border-color);
            text-align: left;
        }

        .table-custom td {
            padding: 15px;
            vertical-align: middle;
            border-bottom: 1px solid var(--border-color);
            color: #333;
            font-size: 14px;
        }

        .table-custom tr:last-child td {
            border-bottom: none;
        }

        .table-custom tr:hover {
            background-color: #fdfdfd;
        }

    /* Status Badges */
    .status-badge {
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
    }

    .badge-warning {
        background-color: #fff3cd;
        color: #856404;
    }

    .badge-success {
        background-color: #d1e7dd;
        color: #0f5132;
    }

    .badge-info {
        background-color: #cff4fc;
        color: #055160;
    }

    .badge-danger {
        background-color: #f8d7da;
        color: #842029;
    }

    /* Action Buttons */
    .btn-action {
        background-color: var(--primary);
        color: white;
        padding: 6px 12px;
        border-radius: 4px;
        text-decoration: none;
        font-size: 13px;
        font-weight: 500;
        border: none;
        transition: 0.2s;
        display: inline-flex;
        align-items: center;
    }

        .btn-action:hover {
            background-color: #0b5ed7;
            color: white;
            transform: translateY(-1px);
        }

    /* Pagination */
    .pagination-wrapper {
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: white;
        border-top: 1px solid var(--border-color);
    }

    .pagination {
        display: inline-flex;
        padding-left: 0;
        list-style: none;
        margin: 0;
    }

        .pagination li {
            margin: 0 2px;
        }

            .pagination li a, .pagination li span {
                padding: 6px 12px;
                border-radius: 4px;
                border: 1px solid #dee2e6;
                color: var(--primary);
                text-decoration: none;
                font-size: 14px;
                background: white;
            }

            .pagination li.active span {
                background-color: var(--primary);
                color: white;
                border-color: var(--primary);
            }
</style>

<div class="container content-wrapper">

    <div class="page-header">
        <h3 class="page-title">
            <i class="far fa-calendar-alt text-primary me-2"></i> Quản lý Lịch hẹn
        </h3>

        <div class="filter-tabs">
            <a href="@Url.Action("Lichdangcho", "Bacsi", new { id = userBS.IDQuanTri })" class="filter-link">
                <i class="fas fa-hourglass-half me-1"></i> Chờ xác nhận
            </a>
            <a href="@Url.Action("Lichdaxacnhan", "Bacsi", new { id = userBS.IDQuanTri })" class="filter-link">
                <i class="fas fa-check-circle me-1"></i> Đã xác nhận
            </a>
            <a href="@Url.Action("Kiemtralichhen", "Bacsi", new { id = userBS.IDQuanTri })" class="filter-link active">
                <i class="fas fa-list me-1"></i> Tất cả
            </a>
        </div>
    </div>

    <div class="table-container">
        <table class="table-custom">
            <thead>
                <tr>
                    <th width="20%">Người đặt lịch</th>
                    <th width="25%">Nội dung tư vấn</th>
                    <th width="15%">Thời gian hẹn</th>
                    <th width="15%">Trạng thái</th>
                    <th width="15%">Zoom / Ghi chú</th>
                    <th width="10%" class="text-center">Hành động</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.Count == 0)
                {
                    <tr>
                        <td colspan="6" class="text-center py-4 text-muted">
                            Chưa có lịch hẹn nào.
                        </td>
                    </tr>
                }

                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            <div class="fw-bold">@Html.DisplayFor(modelItem => item.NguoiDung.HoTen)</div>
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.ChuDe)
                        </td>
                        <td>
                            <div class="d-flex align-items-center">
                                <i class="far fa-clock text-muted me-2"></i>
                                <span>@Html.DisplayFor(modelItem => item.BatDau)</span>
                            </div>
                        </td>
                        <td>
                            @if (item.TrangThai == 0)
                            {
                                <span class="status-badge badge-warning">
                                    <i class="fas fa-spinner fa-spin me-1"></i> Chờ xác nhận
                                </span>
                            }
                            else if (item.TrangThai == 1)
                            {
                                <span class="status-badge badge-success">
                                    <i class="fas fa-check me-1"></i> Đã xác nhận
                                </span>
                            }
                            else if (item.TrangThai == 2)
                            {
                                <span class="status-badge badge-info">
                                    <i class="fas fa-check-double me-1"></i> Hoàn thành
                                </span>
                            }
                            else
                            {
                                <span class="status-badge badge-danger">Lỗi</span>
                            }
                        </td>
                        <td>
                            <div class="small">
                             
                                @if (!string.IsNullOrEmpty(item.KetQuaKham))
                                {
                                    <div class="text-muted"><i class="fas fa-sticky-note me-1"></i> @item.KetQuaKham</div>
                                }
                            </div>
                        </td>
                        <td class="text-center">
                            @if (item.TrangThai == 0)
                            {
                                <a href="@Url.Action("Xacnhanlichhen", new { id = item.IDLichKham })" class="btn-action" title="Xác nhận lịch hẹn">
                                    <i class="fas fa-check me-1"></i> Duyệt
                                </a>
                            }
                            else
                            {
                                <span class="text-muted small"><i class="fas fa-lock"></i></span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <div class="pagination-wrapper">
            <div class="text-muted small">
                Trang @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) trên tổng số @Model.PageCount
            </div>

            <div>
                @Html.PagedListPager(Model, page => Url.Action("Kiemtralichhen", new { page }),
                new PagedListRenderOptions
                     {
                    LiElementClasses = new string[] { "page-item" },
                    UlElementClasses = new string[] { "pagination" }
                })
            </div>
        </div>
    </div>
</div>